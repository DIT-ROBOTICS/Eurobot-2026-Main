<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4">
    <!-- 
        Black Robot, Yellow Team, Plan 0 (Test Plan)
        Tests the DecisionCore -> OnDockAction pipeline
        Pattern: TAKE x2, then PUT x2
    -->
    
    <!-- ============================================= -->
    <!-- TAKE SubTree: Go to collection point and take -->
    <!-- ============================================= -->
    <BehaviorTree ID="TakeSubTree">
        <Sequence>
            <!-- Dock to collection point -->
            <OnDockAction
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"
                dock_type="dock_y_loose_linearBoost"
                isPureDocking="false"
                finish_pose="{dock_result}"/>
            
            <!-- Publish TAKE command to firmware -->
            <MissionPublisher
                ActionType="take"
                targetPoseSideIdx="{target_side}"
                targetPoseIdx="{target_idx}"/>
        </Sequence>
    </BehaviorTree>
    
    <!-- ============================================= -->
    <!-- PUT SubTree: Go to pantry point and put -->
    <!-- ============================================= -->
    <BehaviorTree ID="PutSubTree">
        <Sequence>
            <!-- Dock to pantry point -->
            <OnDockAction
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"
                dock_type="dock_y_loose_linearBoost"
                isPureDocking="false"
                finish_pose="{dock_result}"/>
            
            <!-- Publish PUT command to firmware -->
            <MissionPublisher
                ActionType="put"
                targetPoseSideIdx="{target_side}"
                targetPoseIdx="{target_idx}"/>
        </Sequence>
    </BehaviorTree>
    
    <!-- ============================================= -->
    <!-- Main Tree: Complete collection cycle -->
    <!-- Pattern: Fill all 4 robot sides, then empty them to pantries -->
    <!-- Repeat twice to handle all 8 collection points -->
    <!-- ============================================= -->
    <BehaviorTree ID="MainTree">
        <Sequence>
            <!-- Initialize receivers first -->
            <CamReceiver/>
            <LocReceiver/>
            
            <!-- ========== CYCLE 1: Fill 4 sides, empty to pantries ========== -->
            
            <!-- TAKE 1: Fill BACK side (2) -->
            <DecisionCore 
                ActionType="take"
                RobotSideIdx="2"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="TakeSubTree" _autoremap="true"/>
            
            <!-- TAKE 2: Fill FRONT side (0) -->
            <DecisionCore 
                ActionType="take"
                RobotSideIdx="0"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="TakeSubTree" _autoremap="true"/>
            
            <!-- TAKE 3: Fill RIGHT side (1) -->
            <DecisionCore 
                ActionType="take"
                RobotSideIdx="1"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="TakeSubTree" _autoremap="true"/>
            
            <!-- TAKE 4: Fill LEFT side (3) -->
            <DecisionCore 
                ActionType="take"
                RobotSideIdx="3"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="TakeSubTree" _autoremap="true"/>
            
            <!-- PUT 1: Empty BACK side (2) to pantry -->
            <DecisionCore 
                ActionType="put"
                RobotSideIdx="2"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="PutSubTree" _autoremap="true"/>
            
            <!-- PUT 2: Empty FRONT side (0) to pantry -->
            <DecisionCore 
                ActionType="put"
                RobotSideIdx="0"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="PutSubTree" _autoremap="true"/>
            
            <!-- PUT 3: Empty RIGHT side (1) to pantry -->
            <DecisionCore 
                ActionType="put"
                RobotSideIdx="1"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="PutSubTree" _autoremap="true"/>
            
            <!-- PUT 4: Empty LEFT side (3) to pantry -->
            <DecisionCore 
                ActionType="put"
                RobotSideIdx="3"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="PutSubTree" _autoremap="true"/>
            
            <!-- ========== CYCLE 2: Fill 4 sides again, empty to pantries ========== -->
            
            <!-- TAKE 5: Fill BACK side (2) -->
            <DecisionCore 
                ActionType="take"
                RobotSideIdx="2"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="TakeSubTree" _autoremap="true"/>
            
            <!-- TAKE 6: Fill FRONT side (0) -->
            <DecisionCore 
                ActionType="take"
                RobotSideIdx="0"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="TakeSubTree" _autoremap="true"/>
            
            <!-- TAKE 7: Fill RIGHT side (1) -->
            <DecisionCore 
                ActionType="take"
                RobotSideIdx="1"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="TakeSubTree" _autoremap="true"/>
            
            <!-- TAKE 8: Fill LEFT side (3) -->
            <DecisionCore 
                ActionType="take"
                RobotSideIdx="3"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="TakeSubTree" _autoremap="true"/>
            
            <!-- PUT 5: Empty BACK side (2) to pantry -->
            <DecisionCore 
                ActionType="put"
                RobotSideIdx="2"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="PutSubTree" _autoremap="true"/>
            
            <!-- PUT 6: Empty FRONT side (0) to pantry -->
            <DecisionCore 
                ActionType="put"
                RobotSideIdx="0"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="PutSubTree" _autoremap="true"/>
            
            <!-- PUT 7: Empty RIGHT side (1) to pantry -->
            <DecisionCore 
                ActionType="put"
                RobotSideIdx="1"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="PutSubTree" _autoremap="true"/>
            
            <!-- PUT 8: Empty LEFT side (3) to pantry -->
            <DecisionCore 
                ActionType="put"
                RobotSideIdx="3"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="PutSubTree" _autoremap="true"/>
            
        </Sequence>
    </BehaviorTree>
</root>
