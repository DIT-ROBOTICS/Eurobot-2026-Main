<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4">
    <!-- 
        Black Robot, Yellow Team, Plan 0 (Test Plan)
        Tests the DecisionCore -> OnDockAction pipeline
        Pattern: TAKE x2, then PUT x2
    -->
    
    <!-- ============================================= -->
    <!-- TAKE SubTree: Go to collection point and take -->
    <!-- ============================================= -->
    <BehaviorTree ID="TakeSubTree">
        <Sequence>
            <!-- Dock to collection point -->
            <OnDockAction
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"
                dock_type="dock_y_loose_linearBoost"
                isPureDocking="false"
                finish_pose="{dock_result}"/>
            
            <!-- Publish TAKE command to firmware -->
            <MissionPublisher
                ActionType="take"
                targetPoseSideIdx="{target_side}"
                targetPoseIdx="{target_idx}"/>
        </Sequence>
    </BehaviorTree>
    
    <!-- ============================================= -->
    <!-- PUT SubTree: Go to pantry point and put -->
    <!-- ============================================= -->
    <BehaviorTree ID="PutSubTree">
        <Sequence>
            <!-- Dock to pantry point -->
            <OnDockAction
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"
                dock_type="dock_y_loose_linearBoost"
                isPureDocking="false"
                finish_pose="{dock_result}"/>
            
            <!-- Publish PUT command to firmware -->
            <MissionPublisher
                ActionType="put"
                targetPoseSideIdx="{target_side}"
                targetPoseIdx="{target_idx}"/>
        </Sequence>
    </BehaviorTree>
    
    <!-- ============================================= -->
    <!-- Main Tree: TAKE x2, then PUT x2 -->
    <!-- ============================================= -->
    <BehaviorTree ID="MainTree">
        <Sequence>
            <!-- Initialize receivers first -->
            <CamReceiver/>
            <LocReceiver/>
            
            <!-- TAKE Phase: Take from 2 collection points -->
            <DecisionCore 
                ActionType="take"
                RobotSideIdx="2"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="TakeSubTree" _autoremap="true"/>
            
            <DecisionCore 
                ActionType="take"
                RobotSideIdx="0"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="TakeSubTree" _autoremap="true"/>
            
            <!-- PUT Phase: Put to 2 pantry points -->
            <DecisionCore 
                ActionType="put"
                RobotSideIdx="0"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="PutSubTree" _autoremap="true"/>
            
            <DecisionCore 
                ActionType="put"
                RobotSideIdx="0"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="PutSubTree" _autoremap="true"/>

            <DecisionCore 
                ActionType="take"
                RobotSideIdx="2"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="TakeSubTree" _autoremap="true"/>

            <DecisionCore 
                ActionType="put"
                RobotSideIdx="0"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="PutSubTree" _autoremap="true"/>

            <DecisionCore 
                ActionType="take"
                RobotSideIdx="2"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="TakeSubTree" _autoremap="true"/>

            <DecisionCore 
                ActionType="put"
                RobotSideIdx="0"
                nextActionType="{next_action}"
                targetPoseIdx="{target_idx}"
                targetPoseSideIdx="{target_side}"
                targetDirection="{target_dir}"/>
            <SubTree ID="PutSubTree" _autoremap="true"/>
        </Sequence>
    </BehaviorTree>
</root>
